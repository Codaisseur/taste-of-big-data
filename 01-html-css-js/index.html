<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title>Movie Recommendations</title>
    <script src='./papaparse.js'></script>
    <script>
    'use strict';

    var movies = new Array();

    // Callback for how a csv row should be parsed
    function parseMovieDatum(row) {
      var movieDatum = row.data[0];
      movies.push(interestingFields(movieDatum));
    };

    // What do we need to display to our user?
    function interestingFields(movieDatum){
      return {
        title:    movieDatum.title,
        // overview: movieDatum.overview,
        year:     new Date(Date.parse(movieDatum.release_date)).getFullYear(),
        votes:    movieDatum.vote_count,
        score:    movieDatum.vote_average,
      }
    }

    // debugger
    Papa.parse("tmdb_5000_movies.csv", {
      download: true,
      header: true,
      worker: true,
      dynamicTyping: true,
      preview: 10, //limit the amount of results | delete when done with setup
      step: parseMovieDatum,
      complete: displayMovies,
    });

    function displayMovies(){
      renderMovies(bestMovies(movies, 10), "most-popular");
    }

    function renderMovies(movies, parentElement){
      var parentList = document.getElementById(parentElement);

      for(var movie of movies){
        var movieHTML = document.createElement('div')
        movieHTML.innerHTML = `${movie.title} (${movie.score})`;
        parentList.appendChild(movieHTML);
      };

    }

    // return movies;

    //order movies param on score, and return the top 5 of it
    function bestMovies(movies, amount=5){
      // debugger
      movies = movies.sort((a,b) => b.score - a.score);
      // console.log(movies.map((movie) => movie.score));//.[0,amount]);
      return movies
    };

    // movies = parseMovies();
    // debugger;
    // console.log(movies);
    // bestMovies(movies);



    // window.onload(parseMovies);
    // console.log(movies.filter(movie => movie.votes > 3));
      // );//.filter((x) => x.votes >= 400));
    </script>
    <script>
      // "use strict";
      // var request = new XMLHttpRequest();
      // request.overrideMimeType("application/json");
      // request.open('GET', 'movies.json');

      // request.onload = function() {
      //   if (request.status >= 200 && request.status < 400) {
      //     let movieData, perYear, relevantMovies;

      //     movieData = JSON.parse(request.responseText);
      //     relevantMovies = movieData.filter(x => x.votes >= 400)
      //     perYear = relevantMovies.reduce(function(accumulator, movie) {
      //       accumulator[movie.year] = accumulator[movie.year] || {}
      //       if ( !(accumulator[movie.year].score) || accumulator[movie.year].score < movie.score) {
      //         accumulator[movie.year].score = movie.score;
      //         accumulator[movie.year].title = movie.title;
      //       }
      //       return accumulator;
      //     }, new Object());
      //     console.log(`raw amount: ${movieData.length}, relevant amount: ${relevantMovies.length}`);
      //     console.table(perYear);
      //   } else {
      //     // We reached our target server, but it returned an error
      //     console.warn("Please return some data!")
      //   }
      // };

      // request.onerror = function() {
      //   console.error("start your server!")
      // };

      // request.send();

  </script>
    </head>

  <body>
    <h1>Movie Recommendations</h1>

    <ul>
      <li id="most-popular">Most popular movies</li>
      <ul>
      </ul>

      <li>Most popular per year</li>
      <li>Best movies per genre</li>
    </ul>

    <footer>Made with &hearts; at Taste of Code</footer>
  </body>
</html>
