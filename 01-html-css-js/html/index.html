<!DOCTYPE html>
<html>
  <head>
    <title>Taste of Big Data</title>
    <script>
      var request = new XMLHttpRequest();
      request.open('GET', 'http://localhost:3000/movies', true);

      request.onload = function() {
        if (request.status >= 200 && request.status < 400) {
          let movieData, perYear, relevantMovies;

          movieData = JSON.parse(request.responseText);
          relevantMovies = movieData.filter(x => x.votes >= 400)
          perYear = relevantMovies.reduce(function(accumulator, movie) {
            accumulator[movie.year] = accumulator[movie.year] || {}
            if ( !(accumulator[movie.year].score) || accumulator[movie.year].score < movie.score) {
              accumulator[movie.year].score = movie.score;
              accumulator[movie.year].title = movie.title;
            }
            return accumulator;
          }, new Object());
          console.log(`raw amount: ${movieData.length}, relevant amount: ${relevantMovies.length}`);
          console.table(perYear);
        } else {
          // We reached our target server, but it returned an error
          console.warn("Please return some data!")
        }
      };

      request.onerror = function() {
        console.error("start your server!")
      };

      request.send();
  </script>
    </head>

  <body>
    <h1>Big Data</h1>

    <ul>
      <li>Populairste films</li>
      <li>Populairste films per jaar</li>
      <li>Populairste film per genre</li>
    </ul>

    <footer>Made with &hearts; at Taste of Code</footer>
  </body>
</html>
